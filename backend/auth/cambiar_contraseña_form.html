<form id="formPassword">
    <label>Nueva contraseña</label><br>
    <input type="password" id="pass1" required><br><br>

    <label>Confirmar contraseña</label><br>
    <input type="password" id="pass2" required><br><br>

    <button type="submit">Cambiar contraseña</button>
</form>

<script>
document.getElementById("formPassword").addEventListener("submit", function(e){
    e.preventDefault();

    const p1 = document.getElementById("pass1").value;
    const p2 = document.getElementById("pass2").value;

    // Validación fuerte en frontend
    const fuerte = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{10,}$/;

    if (p1 !== p2) {
        Swal.fire("Error", "Las contraseñas no coinciden", "error");
        return;
    }

    if (!fuerte.test(p1)) {
        Swal.fire(
            "Contraseña débil",
            "Debe tener mínimo 10 caracteres, mayúscula, minúscula, número y símbolo",
            "warning"
        );
        return;
    }

    fetch("cambiar_password.php", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: `password=${encodeURIComponent(p1)}`
    })
    .then(r => r.json())
    .then(res => {
        if (res.ok) {
            Swal.fire({
                icon: "success",
                title: "Contraseña actualizada",
                text: "Se cerrará la sesión por seguridad",
                confirmButtonText: "OK"
            }).then(() => {
                window.location.href = "logout.php";
            });
        } else {
            Swal.fire("Error", res.msg, "error");
        }
    });
});
</script>
